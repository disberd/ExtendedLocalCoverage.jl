# ExtendedLocalCoverage

[![Stable Documentation](https://img.shields.io/badge/docs-stable-blue.svg)](https://disberd.github.io/ExtendedLocalCoverage.jl/stable)
[![In development documentation](https://img.shields.io/badge/docs-dev-blue.svg)](https://disberd.github.io/ExtendedLocalCoverage.jl/dev)
[![Test workflow status](https://github.com/disberd/ExtendedLocalCoverage.jl/actions/workflows/Test.yml/badge.svg?branch=main)](https://github.com/disberd/ExtendedLocalCoverage.jl/actions/workflows/Test.yml?query=branch%3Amain)
[![Lint workflow Status](https://github.com/disberd/ExtendedLocalCoverage.jl/actions/workflows/Lint.yml/badge.svg?branch=main)](https://github.com/disberd/ExtendedLocalCoverage.jl/actions/workflows/Lint.yml?query=branch%3Amain)
[![Docs workflow Status](https://github.com/disberd/ExtendedLocalCoverage.jl/actions/workflows/Docs.yml/badge.svg?branch=main)](https://github.com/disberd/ExtendedLocalCoverage.jl/actions/workflows/Docs.yml?query=branch%3Amain)
[![Coverage](https://codecov.io/gh/disberd/ExtendedLocalCoverage.jl/branch/main/graph/badge.svg)](https://codecov.io/gh/disberd/ExtendedLocalCoverage.jl)
[![Contributor Covenant](https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg)](CODE_OF_CONDUCT.md)
[![BestieTemplate](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/JuliaBesties/BestieTemplate.jl/main/docs/src/assets/badge.json)](https://github.com/JuliaBesties/BestieTemplate.jl)

This package extends the functionality of [LocalCoverage.jl](https://github.com/JuliaCI/LocalCoverage.jl) by adding the following features:
- Automatically extract the source files for the provided package using `Revise.parse_pkg_files`.
- Automatically create an xml cobertura coverage, useful for Gitlab which can use it to automatically higlight missing coverage in the web ui of the merge requests.
- Automatically generate a static HTML coverage report using a native julia implementation relying on `HypertextTemplates.jl`
  - Unlike the implementation in the original LocalCoverage.jl package, this does not require the LCOV dependency and also works on windows

This package was mainly created to provide easier access to code coverage within a private self-hosted gitlab instance, where codecov can not be used as is, but an HTML coverage report can be directly integrated within the gitlab web interface.

It is also convenient for getting an HTML coverage report locally without always relying on codecov from GH actions.

You can see an example of the generated HTML coverage report [here](https://disberd.github.io/ExtendedLocalCoverage.jl/coverage_example/), which was generated by calling `generate_package_coverage(;)` on this package.

## Installation
The package is not currently registered in General, so you need to add it to your environment by doing:
```julia
] add https://github.com/disberd/ExtendedLocalCoverage.jl
```
or 
```julia
import Pkg
Pkg.add(url="https://github.com/disberd/ExtendedLocalCoverage.jl")
```

## Usage
For the basic usage which automatically extracts source files (including extensions) and generates the coverage report both in xml and html format, you can simply do the following (within the env of the package you are developing and making sure you have ExtendedLocalCoverage.jl in the `LOAD_PATH`):
```julia
using ExtendedLocalCoverage
cov_data = generate_package_coverage();
```

See the [developer documentation](https://disberd.github.io/ExtendedLocalCoverage.jl/dev) for more details.

## How to Cite

If you use ExtendedLocalCoverage.jl in your work, please cite using the reference given in [CITATION.cff](https://github.com/disberd/ExtendedLocalCoverage.jl/blob/main/CITATION.cff).

## Contributing

If you want to make contributions of any kind, please first that a look into our [contributing guide directly on GitHub](docs/src/90-contributing.md) or the [contributing page on the website](https://disberd.github.io/ExtendedLocalCoverage.jl/dev/90-contributing/)

---

### Contributors

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->

<!-- markdownlint-restore -->
<!-- prettier-ignore-end -->

<!-- ALL-CONTRIBUTORS-LIST:END -->
